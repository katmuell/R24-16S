---
title: "Bubble Graphs"
author: "Katherine Mueller"
date: "4/23/2021"
output: html_document
---
##Generation of Bubble Graphs for R24 sample series
Bubble graph code was generated by Lauren Davey for use in Figure 8 of the Akkermansia Collection paper. We reuse it here to generate a similar graph for the full R24 data set.

```{r}
library(ggplot2)
```

#Set ggplot theme 
```{r}
my.theme = theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
                 panel.background = element_blank(), axis.line = element_line(colour = "black"), plot.title=element_text(size=25), 
                 axis.title.x=element_text(size=12, face = "bold"), axis.title.y=element_text(size=12, face = "bold"), legend.text=element_text(size=12),
                 axis.text.x=element_text(size=12), axis.text.y=element_text(size=12), 
                 legend.title=element_text(size=12, face="bold"), legend.key=element_blank())


#set colour scheme
#Use scale colour manual to use these custom colours
cols <- c("AmI" = "aquamarine3", "AmII" = "mediumpurple3", "AmIV" = "steelblue2", "Unknown" = "grey25")
```

#Change sequence counts to percent abundance
```{r}
b8$RelPer <- 100*b8$Relative_Akkermansia_Abundance
```

#Generate bubble graph
Adjust size breaks as needed for your data and change to shape  
```{r}
#Plot with filled circles
tiff("bubble_Feb6_perlog.tiff", units="in", width=8.75, height=7.25, res=300)

ggplot(b8, aes(x = as.factor(Time), y = Patient_ID, col=Clade, shape=Isolate)) +
  geom_point(aes(size = RelPer), alpha=0.5, shape = 19) +
  scale_size(breaks = c(0, 0.01, 0.1, 10, 20, 30),range = c(2,20)) + my.theme + scale_y_discrete(limits=rev) + xlab("Time (months)") +
  ylab("Patient ID") + labs(size = "Akkermansia 16S rRNA Abundance (%)", col = "Phylogroup Compositon") + scale_colour_manual(values = cols)
dev.off()

#Plot with empty circles
tiff("bubble_Feb6_perlog.tiff", units="in", width=8.75, height=7.25, res=300)

ggplot(b8, aes(x = as.factor(Time), y = Patient_ID, col=Clade, shape=Isolate)) +
  geom_point(aes(size = RelPer), alpha=0.5, shape = 21, stroke=1.5) +
  scale_size(breaks = c(0, 0.01, 0.1, 10, 20, 30),range = c(2,20)) + my.theme + scale_y_discrete(limits=rev) + xlab("Time (months)") +
  ylab("Patient ID") + labs(size = "Akkermansia Relative Abundance (%)") + scale_colour_manual(values = cols)
dev.off()